"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

/**
 * Adds started_at, ended_at and duration headers to the response
 */
var DurationMiddleware = function DurationMiddleware() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      mockRequest = _ref.mockRequest;

  return {
    prepareRequest: function prepareRequest(next) {
      if (mockRequest) {
        return next();
      }

      return next().then(function (request) {
        return request.enhance({
          headers: {
            'X-Started-At': Date.now()
          }
        });
      });
    },
    response: function response(next) {
      return next().then(function (response) {
        var endedAt = Date.now();
        var startedAt = response.request().headers()['x-started-at'];
        return response.enhance({
          headers: {
            'X-Started-At': startedAt,
            'X-Ended-At': endedAt,
            'X-Duration': endedAt - startedAt
          }
        });
      });
    }
  };
};

var _default = DurationMiddleware;
exports["default"] = _default;